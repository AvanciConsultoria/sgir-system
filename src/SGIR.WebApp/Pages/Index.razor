@page "/"
@page "/dashboard"

<PageTitle>Dashboard - SGIR</PageTitle>

<!-- Stats Grid -->
<div class="stats-grid">
    <div class="stat-card blue">
        <div class="stat-icon">üìã</div>
        <div class="stat-info">
            <div class="stat-label">Projetos Ativos</div>
            <div class="stat-value">@totalProjetos</div>
            <div class="stat-trend up">
                ‚Üó +2 este m√™s
            </div>
        </div>
    </div>

    <div class="stat-card success">
        <div class="stat-icon">üë•</div>
        <div class="stat-info">
            <div class="stat-label">Colaboradores Aptos</div>
            <div class="stat-value">@colaboradoresAptos/@totalColaboradores</div>
            <div class="stat-trend @(colaboradoresInaptos > 0 ? "down" : "up")">
                @if (colaboradoresInaptos > 0)
                {
                    <span>‚ö†Ô∏è @colaboradoresInaptos inapto(s)</span>
                }
                else
                {
                    <span>‚úÖ Todos aptos</span>
                }
            </div>
        </div>
    </div>

    <div class="stat-card warning">
        <div class="stat-icon">üì¶</div>
        <div class="stat-info">
            <div class="stat-label">Itens de Estoque</div>
            <div class="stat-value">@totalItensEstoque</div>
            <div class="stat-trend @(itensCriticos > 0 ? "down" : "up")">
                @if (itensCriticos > 0)
                {
                    <span>‚ö†Ô∏è @itensCriticos cr√≠tico(s)</span>
                }
                else
                {
                    <span>‚úÖ Estoque OK</span>
                }
            </div>
        </div>
    </div>

    <div class="stat-card danger">
        <div class="stat-icon">üõí</div>
        <div class="stat-info">
            <div class="stat-label">Compras Pendentes</div>
            <div class="stat-value">@comprasPendentes</div>
            <div class="stat-trend @(comprasPendentes > 0 ? "down" : "up")">
                @if (comprasPendentes > 0)
                {
                    <span>‚ö†Ô∏è Aguardando aprova√ß√£o</span>
                }
                else
                {
                    <span>‚úÖ Nenhuma pendente</span>
                }
            </div>
        </div>
    </div>
</div>

<!-- Alerts Section -->
@if (colaboradoresInaptos > 0 || itensCriticos > 0 || comprasPendentes > 0)
{
    <div class="card mb-4">
        <div class="card-header">
            <h5>‚ö†Ô∏è Aten√ß√£o Necess√°ria</h5>
        </div>
        <div class="card-body">
            @if (colaboradoresInaptos > 0)
            {
                <div class="alert alert-warning">
                    <div>
                        <strong>üë• @colaboradoresInaptos colaborador(es) inapto(s)</strong>
                        <p style="margin: 0.5rem 0 0 0; font-size: 0.875rem;">
                            Colaboradores com certifica√ß√µes vencidas n√£o podem ser alocados em projetos.
                            <a href="/colaboradores" style="color: inherit; text-decoration: underline;">Ver detalhes ‚Üí</a>
                        </p>
                    </div>
                </div>
            }

            @if (itensCriticos > 0)
            {
                <div class="alert alert-warning">
                    <div>
                        <strong>üì¶ @itensCriticos item(ns) cr√≠tico(s) no estoque</strong>
                        <p style="margin: 0.5rem 0 0 0; font-size: 0.875rem;">
                            Itens com estoque abaixo do m√≠nimo necess√°rio. Considere fazer pedidos urgentes.
                            <a href="/ferramentas" style="color: inherit; text-decoration: underline;">Ver estoque ‚Üí</a>
                        </p>
                    </div>
                </div>
            }

            @if (comprasPendentes > 0)
            {
                <div class="alert alert-info">
                    <div>
                        <strong>üõí @comprasPendentes compra(s) pendente(s)</strong>
                        <p style="margin: 0.5rem 0 0 0; font-size: 0.875rem;">
                            Solicita√ß√µes de compra geradas automaticamente aguardando aprova√ß√£o.
                            <a href="/compras" style="color: inherit; text-decoration: underline;">Ver compras ‚Üí</a>
                        </p>
                    </div>
                </div>
            }
        </div>
    </div>
}

<!-- Quick Actions -->
<div class="card">
    <div class="card-header">
        <h5>‚ö° A√ß√µes R√°pidas</h5>
    </div>
    <div class="card-body">
        <div class="grid grid-cols-3 gap-2">
            <a href="/projetos" class="btn btn-lg btn-primary">
                ‚ûï Novo Projeto
            </a>
            <a href="/gap-analysis" class="btn btn-lg btn-warning">
                üìä Analisar D√©ficit
            </a>
            <a href="/importar" class="btn btn-lg btn-success">
                üì§ Importar Excel
            </a>
            <a href="/colaboradores" class="btn btn-lg btn-outline">
                üë• Novo Colaborador
            </a>
            <a href="/ferramentas" class="btn btn-lg btn-outline">
                üî® Nova Ferramenta
            </a>
            <a href="/compras" class="btn btn-lg btn-outline">
                üõçÔ∏è Ver Compras
            </a>
        </div>
    </div>
</div>

@if (isLoading)
{
    <div style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 9999;">
        <div style="background: white; padding: 2rem; border-radius: 12px; text-align: center;">
            <div style="width: 50px; height: 50px; border: 4px solid var(--gray-lighter); border-top-color: var(--primary-blue); border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 1rem;"></div>
            <p style="margin: 0; color: var(--gray-dark);">Carregando dados...</p>
        </div>
    </div>
}

<style>
    @@keyframes spin {
        to { transform: rotate(360deg); }
    }
</style>

@code {
    private bool isLoading = false;

    private int totalProjetos = 0;
    private int totalColaboradores = 0;
    private int colaboradoresAptos = 0;
    private int colaboradoresInaptos = 0;
    private int totalItensEstoque = 0;
    private int itensCriticos = 0;
    private int comprasPendentes = 0;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            isLoading = true;
            await CarregarDados();
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Erro ao carregar dashboard: {ex.Message}");
        }
        finally
        {
            isLoading = false;
        }
    }

    private async Task CarregarDados()
    {
        // Mock data for now - will be replaced with actual database queries
        await Task.Delay(500); // Simulate loading

        totalProjetos = 5;
        totalColaboradores = 10;
        colaboradoresAptos = 8;
        colaboradoresInaptos = 2;
        totalItensEstoque = 50;
        itensCriticos = 3;
        comprasPendentes = 1;
    }
}
